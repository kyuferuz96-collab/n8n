version: '3.8'

services:
  n8n-unlocked:
    image: <ä½ çš„ç”¨æˆ·å>/n8n-unlocked:unlocked-latest
    container_name: n8n-unlocked
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # ========================================
      # åŸºç¡€é…ç½®
      # ========================================
      - N8N_HOST=0.0.0.0
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      
      # ========================================
      # ğŸ”“ AI åŠŸèƒ½é…ç½®ï¼ˆå¿…é¡»ï¼‰
      # ========================================
      - N8N_AI_ENABLED=true
      
      # API Keyï¼ˆå¿…é¡»è®¾ç½®ï¼Œè§¦å‘ç›´è¿æ¨¡å¼ï¼‰
      - N8N_AI_ANTHROPIC_KEY=your-api-key-here
      
      # AI æ¥å£åœ°å€ï¼ˆå¿…é¡»è®¾ç½®ï¼‰
      # ç¤ºä¾‹ï¼š
      # - Moonshot AI: https://api.moonshot.cn
      # - OpenAI: https://api.openai.com/v1
      # - è‡ªå»ºæœåŠ¡: https://your-ai-service.com
      - N8N_AI_ASSISTANT_BASE_URL=https://api.moonshot.cn
      
      # ========================================
      # ğŸ”“ è‡ªå®šä¹‰æ¨¡å‹é…ç½®ï¼ˆå¯é€‰ï¼‰
      # ========================================
      
      # æ¨¡å‹åç§°ï¼ˆå¯é€‰ï¼Œä¸è®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰
      # ç¤ºä¾‹ï¼š
      # - Moonshot: moonshot-v1-8k, moonshot-v1-32k, moonshot-v1-128k
      # - OpenAI: gpt-4, gpt-3.5-turbo
      # - Kimi: kimi-k2.5
      - N8N_AI_MODEL_NAME=moonshot-v1-32k
      
      # åè®®ç±»å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤ anthropicï¼‰
      # é€‰é¡¹ï¼šanthropic æˆ– openai
      # - anthropic: ä½¿ç”¨ Claude åè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ /v1/messagesï¼‰
      # - openai: ä½¿ç”¨ OpenAI åè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ /chat/completionsï¼‰
      - N8N_AI_PROVIDER=anthropic
      
      # ========================================
      # æ•°æ®æŒä¹…åŒ–
      # ========================================
      - N8N_USER_FOLDER=/home/node/.n8n
      
      # ========================================
      # å…¶ä»–é…ç½®ï¼ˆå¯é€‰ï¼‰
      # ========================================
      
      # æ—¶åŒº
      - TZ=Asia/Shanghai
      
      # æ—¥å¿—çº§åˆ«
      - N8N_LOG_LEVEL=info
      
      # æ‰§è¡Œæ•°æ®ä¿å­˜
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true
      
    volumes:
      # æ•°æ®æŒä¹…åŒ–
      - n8n_data:/home/node/.n8n
      
    # å¥åº·æ£€æŸ¥
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5678/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  n8n_data:
    driver: local

# ========================================
# ä½¿ç”¨è¯´æ˜
# ========================================
#
# 1. æ›¿æ¢ <ä½ çš„ç”¨æˆ·å> ä¸ºä½ çš„ Docker Hub ç”¨æˆ·å
# 2. è®¾ç½® N8N_AI_ANTHROPIC_KEY ä¸ºä½ çš„ API Key
# 3. è®¾ç½® N8N_AI_ASSISTANT_BASE_URL ä¸ºä½ çš„ AI æœåŠ¡åœ°å€
# 4. æ ¹æ®éœ€è¦è°ƒæ•´ N8N_AI_MODEL_NAME å’Œ N8N_AI_PROVIDER
#
# å¯åŠ¨æœåŠ¡ï¼š
#   docker-compose up -d
#
# æŸ¥çœ‹æ—¥å¿—ï¼š
#   docker-compose logs -f
#
# åœæ­¢æœåŠ¡ï¼š
#   docker-compose down
#
# è®¿é—®åœ°å€ï¼š
#   http://localhost:5678

